
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>bling on software development</title>
  <meta name="author" content="Bailey Ling">

  
  <meta name="description" content="It&rsquo;s unfortunate that I have to remove db4o from my project, but I can&rsquo;t say this was unexpected. The CTO finally came to me today to &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://bling.github.io//blog/page/11">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="bling on software development" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/lib/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href='http://fonts.googleapis.com/css?family=Ubuntu+Mono:400,700,400italic,700italic|Ubuntu:300,400,500,700,300italic,400italic,500italic,700italic' rel='stylesheet' type='text/css'>


  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-38439430-2']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">bling on software development</a></h1>
  
    <h2>when pragmatism meets minimalism</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:bling.github.io/" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2009/08/18/goodbye-db4o-hello-orm/">Goodbye Db4o, Hello ORM</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2009-08-18T00:00:00+00:00" pubdate data-updated="true">Aug 18<span>th</span>, 2009</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>It&rsquo;s unfortunate that I have to remove db4o from my project, but I can&rsquo;t say this was unexpected.  The CTO finally came to me today to voice his concerns on using an object database rather than a relational database.</p>

<p>As typical of many organizations, we have a database team dedicated to maintaining the integrity and performance of our main product.  We are also stored procedure happy and every write <em>and read</em> operation goes through a stored procedure&hellip;.so you can say I was pretty gutsy to even consider using an object database ;&ndash;)</p>

<p>It was fun nonetheless&hellip;</p>

<p>Sooooo&hellip;.which ORM to use?  I&rsquo;ve already read of <a href="http://lmgtfy.com/?q=entity+framework+vote+of+no+confidence">all the things about the Entity Framework</a> already, so I didn&rsquo;t even bother considering it.  Choices came down to just a few:
&ndash; <a href="http://www.castleproject.org/activerecord/index.html">Castle.ActiveRecord</a>
&ndash; <a href="http://fluentnhibernate.org/">Fluent NHibernate</a>
&ndash; <a href="http://www.subsonicproject.com/">SubSonic</a></p>

<p>I&rsquo;ve initially started with Fluent NHibernate.  The main reason is because it&rsquo;s got really good documentation for beginners like me who&rsquo;ve never used NHibernate, and has more configuration options via code.  Even so, it didn&rsquo;t take long for me to run into gazillions of mapping errors though :&ndash;[</p>

<p>I&rsquo;m still undecided whether I prefer <code>ClassMap&lt;&gt;</code> or <code>ActiveRecord</code> attributes though&hellip;</p>

<p>I started porting all my repositories to using NHibernate, and for the most part it wasn&rsquo;t too bad.  I&rsquo;ve learned some things along the way like lazy loading and cascading, but the conclusion is having Fluent NHibernate with pretty code completion isn&rsquo;t going to prevent the need to actually learn NHibernate the old-fashioned way, although it definitely got me up and running a lot faster.</p>

<p>I&rsquo;ll probably write up a quick repository implementation with SubSonic as well as part of my prototype to see which I like.  SubSonic definitely looks more &lsquo;hip&rsquo; with it&rsquo;s very flashy and web 2.0ey looking website :)</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2009/08/15/ddd-tdd-enterprise-library-autofac-and-lokad/">DDD, TDD, Enterprise Library, Autofac, and Lokad.Shared Libs!</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2009-08-15T00:00:00+00:00" pubdate data-updated="true">Aug 15<span>th</span>, 2009</time>
        
      </p>
    
  </header>


  <div class="entry-content"><div class='post'>
So my project has been chuggin along quite nicely, and gave my CTO a quick look over the design of my project of which he was very impressed&#8230;I&#8217;m glad I spent all that time reading up on DDD, BDD, TDD, and listening to all the <a href="http://altnetpodcast.com/">ALT.NET podcasts</a>.

I&#8217;ve learned SOOOOO much in the past month it is ridiculous, mostly thanks to coming across ALT.NET, and then reading everything linked from that source.

I can honestly say I&#8217;m 100% sold on the TDD approach.  Initially, after reading about it I was like, hmmm, yeah, I can see that working, but writing tests first kinda seems dumb and redundant.  After all, obviously you know the tests will pass because you wrote them!!

Then&#8230;I saw the light!!!

I&#8217;m currently prototyping my project, but since I live in the real world I can reasonably assume the prototype will become the real thing.  But that&#8217;s not really an issue having designed everything with DDD and DI.  Once the prototype is done, we can <span style="font-style:italic;">optionally</span> replace the implementation, change the IoC wiring up, and voila, it just works (because we had all those tests written).

Another design choice for the prototype I made was to use <a href="http://www.db4o.com/about/productinformation/">DB4O</a> rather than SQL Server.  DDD emphasizes very much on storing aggregate roots in repositories, and let&#8217;s be honest, object databases work ridiculously well with storing domain entities.

So not only can I speed up development in my prototype by having all repositories go to a DB4O backing store, if it&#8217;s decided we need to change to a relational database, boom, I just need to reimplement all my repositories with <a href="http://nhforge.org/Default.aspx"/>NHibernate</a>.

And just to drive home how easy DB4O is, literally, this is what you need to do to store a User in the database.
<pre>
using (IObjectContainer c = Db4oFactory.OpenFile("database.db"))
{
  c.Store(user);
}
</pre>
Seriously!!!  It <span style="font-weight:bold;">IS</span> that easy!

But back to why I&#8217;m sold on TDD.  Originally, I had IUsersRepository modeled something like this:
<pre>
User GetUserByName(string userName);
User GetUserById(Guid id);
User GetUserByFirstName(string firstName);
</pre>
And then I realized, it&#8217;s a total pain in the butt to be adding all these methods because once the method call reaches the DB4O container, I need to pass in a predicate for the query.  So I thought, I&#8217;ll just pass the predicate directly to DB4O.  I changed all my repositories (I had 4 at the time), to do this instead:
<pre>
User GetUser(Predicate&lt;User&gt; condition);
</pre>
So now I can simply do this:
<pre>
var user = usersRepository.GetUser(x => x.UserName == userName);
</pre>
I&#8217;ve converted 3 methods (and potentially more) into a single method that is very expressive and easy to read (thank you lambdas!).

And then I reran all my tests and they passed&#8230;.which leads to the following conclusion:

<span style="font-weight:bold;">TDD lets you refactor with confidence!</span>

Oh wait, I mentioned <a href="http://code.google.com/p/autofac/">Autofac</a> and <a href="http://code.google.com/p/lokad-shared-libraries/">Lokad.Shared</a> libs in this blog post didn&#8217;t I&#8230;.

To start&#8230;my project has removed all dependencies on the <a href="http://www.codeplex.com/entlib">Enterprise Library</a>.  In my previous post I mentioned how Unity wasn&#8217;t as mature as other frameworks.  Well, it appears that the Logging Block and/or the Exception Handling Block has a dependency on Unity.  I definitely did not like having 2 IoC containers in my bin directory, so I decided maybe I should just ditch the entire thing.

Honestly, I didn&#8217;t really like the EntLib anyways&#8230;.the logging block requires the use of a static class Logger (tight coupling), and the exception block needs a try/catch/handle for any exception you want to handle, again with a static class ExceptionPolicy (more tight coupling!!!).

So now it was a matter of finding a replacement.  There really was only 2 choices: the <a href="http://www.castleproject.org/index.html">Castle Stack</a>, or Autofac+Lokad.Shared.

I was not very impressed with the lack of documentation on the Castle Validator component (or even where to download a binary of it).  Also, I&#8217;m really not a big fan of attributes on parameters.

So what&#8217;s left is Autofac and Lokad.Shared.  I chose Autofac mainly because I love its lambda syntax (and the included performance benefit).  But of more concern is Lokad.Shared.
a) It is basically written by 1 guy
b) It doesn&#8217;t have community inertia

But after reading the <a href="http://abdullin.com/journal/2008/11/23/net-application-block-for-validation-and-business-rules.html">examples</a> <a href="http://abdullin.com/journal/2008/12/1/net-exception-handling-action-policies-application-block.html">here</a> and <a href="http://abdullin.com/journal/2009/1/3/strongly-typed-reflection-in-lokad-shared.html">here</a> I didn&#8217;t have a choice!  It is just too damn nice!

Comparing code I&#8217;m writing today with code I wrote 3 months ago is like light and day&#8230;.on different planets.

And since I&#8217;m very link happy today, check out this awesome add-on called <a href="http://www.exactmagic.com/products/studiotools/index.html">Studio Tools</a>.  It&#8217;s free, only 1.9 megs and has the most impressive and blazing fast file/class/symbol search I&#8217;ve ever seen.</div>
<h2>Comments</h2>
<div class='comments'>
<div class='comment'>
<div class='author'>Codestructioner</div>
<div class='content'>
There&#39;s a few of us floating around who&#39;ve found, like, and use Lokad.Shard (and Lokad.ActionPolicy).</div>
</div>
</div>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2009/08/08/dynamic-proxies/">Dynamic Proxies</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2009-08-08T00:00:00+00:00" pubdate data-updated="true">Aug 8<span>th</span>, 2009</time>
        
      </p>
    
  </header>


  <div class="entry-content">Life has sure been a roller coaster lately ever since I started working on my new project.  I&#8217;ve learned a lot about WCF in the past week.  There&#8217;s really nothing that can teach you faster than trying something out yourself.

I&#8217;ve joined the ranks of countless others who have had to deal with implementing service behaviors to handle WCF exceptions (because by default thrown exceptions fault the communication channel), realized that WCF proxy clients breaks the &#8216;using&#8217; keyword because someone thought it was a good idea to throw exceptions in Dispose(), and even Unity&#8217;s InterfaceInterceptor not <a href="http://unity.codeplex.com/WorkItem/View.aspx?WorkItemId=3685">supporting more than 1 interface</a>!

But now that we&#8217;re talking about proxies, I&#8217;ve been thinking for a while about switching out Unity with a more mature IoC container like Windsor or StructureMap.  There are little touches that other containers have that I miss in Unity.  For example, auto-wiring.

But then again, the integration that Unity has with the rest of the Enterprise Library is very nice, of which I&#8217;m using the Logging and Exception Policy blocks, so it made sense in a way that everything in my bin folder just had Microsoft.Practices.*.dll

But now I&#8217;m seriously reconsidering.
<pre>
public interface ITestService {
  int Count { get; set; }
  void DoWork();
  bool ShouldDoWork();
}
public class TestService : ITestService {
  public int Count { get; set; }
  public void DoWork() { ++Count; }
  bool ShouldDoWork() { return true; }
}
public void HowDoTheyCompare() {
  var unity = (ITestService)new Microsoft.Practices.Unity.InterceptionExtension.InterfaceInterceptor()
                   .CreateProxy(typeof(ITestService), new TestService());
  var castle = new Castle.DynamicProxy.ProxyGenerator()
                   .CreateInterfaceProxyWithTarget&lt;ITestService&gt;(new TestService());

  Thread.Sleep(1000);

  Stopwatch sw = new Stopwatch();
  sw.Start();
  for (int i = 0; i < 1000000; ++i) { if (unity.ShouldDoWork()) unity.DoWork(); }
  sw.Stop();
  Console.WriteLine("unity: " + sw.ElapsedMilliseconds);
  sw.Reset();
  sw.Start();
  for (int i = 0; i < 1000000; ++i) { if (castle.ShouldDoWork()) castle.DoWork(); }
  sw.Stop();
  Console.WriteLine("castle: " + sw.ElapsedMilliseconds);
}
</pre>
Results?
unity: 1787
castle: 136

From this test it looks like the Unity interception is 13x slower&#8230;.but wait!  I mentioned before that Unity has a bug where it can only proxy one interface&#8230;.so to resolve that we would need to use the TransparentProxyInterceptor.

Let&#8217;s change it and test again&#8230;

unity: 30462
castle: 142

Hmmmm&#8230;.214x slower.

I guess we can try the VirtualMethodInterceptor for completeness.  After making all methods virtual, here&#8217;s the results.

unity: 3843
castle: 132

Still 29x slower.

Whatever DynamicProxy is doing&#8230;it&#8217;s orders of magnitude faster than what Unity&#8217;s doing.</div>
<h2>Comments</h2>
<div class='comments'>
<div class='comment'>
<div class='author'>Krzysztof Ko≈∫mic (2)</div>
<div class='content'>
Not only that. Castle has integration with logging, validation framework, much more mature and powerful IoC container, and also nice proxy library.</div>
</div>
</div>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2009/08/06/who-woulda-thought-ilist-kills-wcf/">Who Woulda Thought, IList<> Kills WCF</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2009-08-06T00:00:00+00:00" pubdate data-updated="true">Aug 6<span>th</span>, 2009</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>It can&rsquo;t be that hard!!!</p>

<p>I keep telling myself this.  I&rsquo;m writing a WCF application right now and I&rsquo;ve been running into loads of problems trying to configure things.  ABC right?  Set my address, contract, and binding&hellip;.how hard can it be??  Why is a horrible ExecutionEngineException being thrown and taking down IIS with it???</p>

<p><a href="http://connect.microsoft.com/wcf/feedback/ViewFeedback.aspx?FeedbackID=433569">http://connect.microsoft.com/wcf/feedback/ViewFeedback.aspx?FeedbackID=433569</a></p>

<p>Turns out you can&rsquo;t have an IList&lt;> of DataContracts.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2009/07/29/assimilated-by-altnet/">Assimilated by ALT.NET</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2009-07-29T00:00:00+00:00" pubdate data-updated="true">Jul 29<span>th</span>, 2009</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>It feels good to be revitalized again!</p>

<p>A couple months back I was very unhappy.  I was at a job I didn&rsquo;t particularly like.  The team I worked with was very rigid and used waterfall practices (even though it was a small 5 man team), and they were very resistant to change (I struggled to move them off SourceSafe, and failed).  It was time to job ship and try something else, but then the market crash hit and suddenly having money to put food on the table became a priority.</p>

<p>Life got boring and dull.  I was writing C++ code (which didn&rsquo;t even use boost because it wasn&rsquo;t allowed), and .NET 2 code when 3.5 was out for 3 years already.</p>

<p>I lost all drive to learn and grow, and after 8 hours of work I really didn&rsquo;t want to have anything to do with coding when I was home.</p>

<p>Then my life changed&hellip;</p>

<p>I found a new job, got hired, and it has been a HUGE turnaround.  I haven&rsquo;t been there long (almost done my 3 month probation), but I&rsquo;m finding myself working at home simply because I love what I&rsquo;m doing.</p>

<p>The difference?  My new team actually wants to learn new things and continually improve.</p>

<p>It is just under 3 months, and I have already helped my team implement branching conventions (rather than 2 week code freezes), unit testing conventions (rather than no conventions), and maintaining a CruiseControl.NET build server (rather than no build server).  It sure makes a HUGE difference when what you&rsquo;re doing is valued by your coworkers.</p>

<p>In my 2nd month I was sent to my first conference, DevTeach in Vancouver, and I&rsquo;d probably consider this the biggest trigger of change in my way of thinking.  I was only away from the .NET community for about a year, but sitting in on the sessions with a panel of experts really drove home exactly how obsolete I already was.</p>

<p>I&rsquo;ve heard of Test Driven Development.  But what&rsquo;s this Behavior Driven Development all about?  What&rsquo;s Domain Driven Development?  What is Inversion of Control and why should I care?</p>

<p>And then I came across ALT.NET.  I first heard about it in James Kovacs&#8217; Vancouver DevTeach session on IoC containers, who was telling everyone about a ALT.NET conference that weekend after the DevTeach conference.  I had next to no knowledge about what ALT.NET was, so I skipped out on the conference because I had other obligations that weekend.  I wish I knew more about ALT.NET earlier, because I would have rescheduled my obligation so I could attend the conference!!</p>

<p>It didn&rsquo;t take long for me to be fully immersed in everything the ALT.NET community has to offer, and I was reading up on anything and everything I could.  I practically had years of catchup to do.</p>

<p>And then I was given my big break.  A completely new project with absolutely no dependencies on anything else was assigned to me.  It was going to be a massive n-tier project with web clients, windows clients, business logic, database, and anything else you could think of.  I got the chance to design something big from scratch.</p>

<p>So now I&rsquo;m reading everything I can about domain driven development and making sure I don&rsquo;t do the classic Gang of Four mistake of overdesigning after reading ;)</p>
</div>
  
  


    </article>
  
  <div class="pagination">
    
      <a class="prev" href="/blog/page/12/">&larr; Older</a>
    
    <a href="/blog/archives">Blog Archives</a>
    
    <a class="next" href="/blog/page/10/">Newer &rarr;</a>
    
  </div>
</div>
<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2013/04/19/on-typescript/">On TypeScript</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/04/13/dot-net-slash-wpf-to-html-slash-css-slash-javscript/">.NET/WPF to HTML/CSS/Javscript</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/04/10/jumping-on-the-hacker-blog-bandwagon/">Jumping on the hacker blog bandwagon</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/02/11/writing-macros-with-vim/">Writing Macros with Vim</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/02/10/love-affair-with-vim/">Love Affair with Vim</a>
      </li>
    
      <li class="post">
        <a href="/blog/2012/07/29/snoopshell-evolution/">SnoopShell: Evolution</a>
      </li>
    
      <li class="post">
        <a href="/blog/2012/07/01/snoopshell-marriage-of-snoop-wpf-and/">SnoopShell: The marriage of Snoop WPF and PowerShell</a>
      </li>
    
      <li class="post">
        <a href="/blog/2012/06/08/n2n-net-2-node-part-1/">N2N: .NET 2 Node: Part 1</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>GitHub Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating&#8230;</li>
  </ul>
  
  <a href="https://github.com/bling">@bling</a> on GitHub
  
  <script type="text/javascript">
    $(document).ready(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'bling',
            count: 0,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>





  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2013 - Bailey Ling -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'blingdev';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>



<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) {return;}
  js = d.createElement(s); js.id = id; js.async = true;
  js.src = "//connect.facebook.net/en_US/all.js#appId=212934732101925&xfbml=1";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>



  <script type="text/javascript">
    (function() {
      var script = document.createElement('script'); script.type = 'text/javascript'; script.async = true;
      script.src = 'https://apis.google.com/js/plusone.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(script, s);
    })();
  </script>



  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
